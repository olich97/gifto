# 🚀 Local Development Guide

This guide will help you set up and test the Gifto smart contracts locally using Hardhat.

## 🔧 Prerequisites

- Node.js 18+
- Yarn package manager
- MetaMask or another EVM wallet

## 🏃‍♂️ Quick Start

### Option 1: One-Command Setup (Recommended)
```bash
yarn local:start
```
This will:
- Compile contracts
- Start Hardhat node
- Deploy contracts
- Create test data
- Update .env.local

### Option 2: Step by Step

1. **Compile contracts**
   ```bash
   yarn hardhat:compile
   ```

2. **Run tests to verify everything works**
   ```bash
   yarn hardhat:test
   ```

3. **Start Hardhat node** (in one terminal)
   ```bash
   yarn hardhat:node
   ```

4. **Deploy contracts** (in another terminal)
   ```bash
   yarn local:setup
   ```

5. **Run comprehensive tests**
   ```bash
   yarn local:test
   ```

## 🧪 Available Commands

### Hardhat Commands
```bash
yarn hardhat:compile       # Compile smart contracts
yarn hardhat:test         # Run contract tests
yarn hardhat:node         # Start local blockchain node
yarn hardhat:clean        # Clean build artifacts
yarn hardhat:deploy-local # Deploy to running local node
```

### Local Development Commands
```bash
yarn local:start          # Complete setup (recommended)
yarn local:setup          # Deploy contracts to running node
yarn local:test           # Run comprehensive contract tests
yarn local:full           # Compile + start (alternative)
```

### Testnet Commands
```bash
yarn deploy:sepolia       # Deploy to Sepolia testnet
yarn deploy:mumbai        # Deploy to Polygon Mumbai testnet
yarn verify:sepolia       # Verify contract on Sepolia Etherscan
yarn verify:mumbai        # Verify contract on Mumbai PolygonScan
```

## 🌐 Network Configuration

### Local Hardhat Network
- **RPC URL**: `http://localhost:8545`
- **Chain ID**: `31337`
- **Symbol**: `ETH`
- **Block Explorer**: None (local)

### Pre-funded Test Accounts
The Hardhat node comes with 20 pre-funded accounts, each with 10,000 ETH:

**Account #0 (Main test account):**
- Address: `0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266`
- Private Key: `0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80`

**Account #1:**
- Address: `0x70997970C51812dc3A010C7d01b50e0d17dc79C8`
- Private Key: `0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d`

## 🦊 MetaMask Setup

1. **Add Hardhat Network to MetaMask:**
   - Network Name: `Hardhat Local`
   - New RPC URL: `http://localhost:8545`
   - Chain ID: `31337`
   - Currency Symbol: `ETH`

2. **Import Test Account:**
   - Click "Import Account" in MetaMask
   - Paste the private key from Account #0 above
   - You should see 10,000 ETH balance

## 🎯 Testing the Contract

After running `yarn local:test`, you should see:

```
🧪 Testing GiftCardManager on local network...

👥 Test Accounts:
   Deployer: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
   Sender: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
   Recipient: 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC

🔍 Test 1: Initial State
✅ Total gift cards: 1
✅ Statistics: { created: '1', claimed: '0', cancelled: '0', totalValue: '1.0 ETH' }

🎁 Test 2: Creating Gift Card with ETH
   Sender balance before: 9999.999... ETH
✅ Gift card created! Gas used: 153842
✅ Gift Card ID: 2

🔐 Test 3: Checking Claim Eligibility
✅ Can recipient claim? true

🎯 Test 4: Claiming Gift Card
✅ Gift card claimed! Gas used: 89234
   Net gain (after gas): ~2.49 ETH

⏰ Test 5: Creating and Cancelling Expired Gift Card
✅ Created gift card for cancellation test, ID: 3
⏰ Fast-forwarded time past expiration
✅ Gift card cancelled! Gas used: 78456

📊 Final Statistics
✅ Final State: { totalGiftCards: '3', created: '3', claimed: '1', cancelled: '1', totalValue: '1.0 ETH' }

🎉 Local testing completed!
```

## 📁 Project Structure

```
scripts/
├── dev-setup.js          # Deploy contracts and create test data
├── start-local.sh        # Complete local environment setup
├── test-local.js         # Comprehensive contract testing
├── deploy.js             # General deployment script
└── deploy-testnet.js     # Testnet-specific deployment

contracts/
├── GiftCardManager.sol   # Main contract
├── interfaces/           # Contract interfaces
└── test/                 # Mock contracts for testing
    ├── MockERC20.sol
    └── GiftCardManager.test.js
```

## 🔍 Environment Variables

The setup scripts automatically create/update `.env.local`:

```bash
# Auto-generated by local setup
NEXT_PUBLIC_GIFT_CARD_MANAGER_HARDHAT=0x5FbDB2315678afecb367f032d93F642f64180aa3

# You need to add this manually from https://cloud.reown.com/
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=your_project_id_here
```

## 🐛 Troubleshooting

### Port 8545 Already in Use
```bash
# Kill existing Hardhat processes
pkill -f "hardhat node"
# Or find and kill the specific process
lsof -ti:8545 | xargs kill
```

### Contract Not Found Error
- Make sure you ran `yarn local:setup` after starting the node
- Check that `.env.local` has the correct contract address
- Verify the Hardhat node is running on `http://localhost:8545`

### MetaMask Issues
- Reset MetaMask account: Settings → Advanced → Reset Account
- Make sure you're connected to the Hardhat network
- Check that you imported the correct private key

### Gas Estimation Errors
- Restart the Hardhat node
- Clear MetaMask transaction history
- Make sure you have enough ETH in your test account

## 🎯 Next Steps

1. **Start Frontend Development:**
   ```bash
   yarn dev
   ```

2. **Open Browser:**
   - Go to `http://localhost:3000`
   - Connect MetaMask to Hardhat network
   - Use the test account to interact with contracts

3. **Build Gift Card UI:**
   - Create gift card form
   - Token selection component
   - Redemption interface
   - Transaction status tracking

## 📚 Additional Resources

- [Hardhat Documentation](https://hardhat.org/docs)
- [Wagmi Documentation](https://wagmi.sh/)
- [RainbowKit Documentation](https://rainbowkit.com/)
- [OpenZeppelin Contracts](https://docs.openzeppelin.com/contracts/)

## 💡 Pro Tips

- Keep the Hardhat console open to see transaction logs
- Use `console.log()` in contracts for debugging (requires Hardhat Network)
- Test edge cases like expired gift cards and invalid recipients
- Monitor gas usage to optimize contract efficiency